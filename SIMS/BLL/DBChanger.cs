using System.Collections.Generic;
using SIMS.Service;

namespace SIMS.BLL
{
    public class DBChanger
    {
        private Result result;

        public int Id { get; set; }

        public string Query { get; set; }

        public string QueryLog { get; set; }

        public List<DBChanger> GetAll() => new List<DBChanger>()
    {
      new DBChanger()
      {
        Id = 1,
        Query = "ALTER TABLE dbo.GlobalSetup\r\n                        ADD IsLargeInvoice bit NOT NULL DEFAULT(0)",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 1 + ")"
      },
      new DBChanger()
      {
        Id = 2,
        Query = "ALTER TABLE dbo.GlobalSetup\r\n                        ADD DecimalLengeth int NOT NULL DEFAULT(0)",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 2 + ")"
      },
      new DBChanger()
      {
        Id = 3,
        Query = "ALTER TABLE dbo.GlobalSetup\r\n                        ADD AttandanceRequired bit NOT NULL DEFAULT(0)",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 3 + ")"
      },
      new DBChanger()
      {
        Id = 4,
        Query = "ALTER TABLE dbo.TempSales\r\n                        ALTER COLUMN Sqty money ",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 4 + ")"
      },
      new DBChanger()
      {
        Id = 5,
        Query = "ALTER TABLE dbo.TempSales\r\n                        ALTER COLUMN Rqty money",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 5 + ")"
      },
      new DBChanger()
      {
        Id = 6,
        Query = "ALTER TABLE dbo.TempSales\r\n                        ALTER COLUMN EQty money ",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 6 + ")"
      },
      new DBChanger()
      {
        Id = 7,
        Query = "ALTER TABLE dbo.TempSalesHold\r\n                        ALTER COLUMN SQty money",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 7 + ")"
      },
      new DBChanger()
      {
        Id = 8,
        Query = "ALTER TABLE dbo.TempSalesHold\r\n                        ALTER COLUMN EQty money",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 8 + ")"
      },
      new DBChanger()
      {
        Id = 9,
        Query = "ALTER TABLE dbo.TempSalesHold\r\n                        ALTER COLUMN RQty money",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 9 + ")"
      },
      new DBChanger()
      {
        Id = 10,
        Query = "ALTER TABLE dbo.TempStockReturnShop\r\n                        ALTER COLUMN TQty money",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 10 + ")"
      },
      new DBChanger()
      {
        Id = 11,
        Query = "IF NOT EXISTS ( SELECT * FROM dbo.SalesMan WHERE SMID='0000' )\r\n                            BEGIN\r\n\t                            INSERT INTO dbo.SalesMan\r\n\t                                    ( SMID, SMName, ShopID )\r\n\t                            VALUES  ( N'0000', N'N/A', \r\n\t                                      (SELECT StoreId FROM dbo.GlobalSetup)\r\n\t                                      )\r\n                            END",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 11 + ")"
      },
      new DBChanger()
      {
        Id = 12,
        Query = "ALTER TABLE dbo.Ssummary\r\n                        ADD RoundValue money NULL DEFAULT(0)",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 12 + ")"
      },
      new DBChanger()
      {
        Id = 13,
        Query = "ALTER PROCEDURE dbo.SP_SalesInvoice (@InvoiceNo NVARCHAR(50))\r\nAS\r\nBEGIN\r\n-- SP_SalesInvoice '10022016HM13030001'\r\n\r\nSELECT        Sale.SaleDT, Sale.SupID, Sale.Qty, Sale.CPU, Sale.RPP, Sale.RPU, Sale.VPP, Sale.VPU, Sale.WSP, Sale.WSQ, Sale.sBarCode, Sale.BarCode, Sale.SQty, Sale.rQty, Sale.rAmt, Sale.rVat, Sale.rDisc, \r\n                         Sale.cInvoice, Sale.ShopID, Sale.PayType, Sale.TotalCost, (Sale.TotalAmt+Sale.DiscAmtPrd) AS TotalAmt, Sale.DiscPrcnt, Sale.DiscAmtPrd, Sale.DiscAmt, Sale.VAT, Sale.VATPrd, Sale.NetAmt, Sale.PrdSlNo, Sale.CshAmt, Sale.CrdAmt, \r\n                         CAST( (SELECT SMName FROM dbo.SalesMan WHERE ID=Sale.Salesman) AS NVARCHAR(50)) Salesman, Sale.Invoice, Sale.CardName, Sale.CardNo, Sale.CounterID, Sale.PrvCus, Sale.PrvCusID, Sale.GrandID, Sale.ParentID, Sale.CusName, Sale.Posted, Sale.VATPrcnt, Sale.Returned, \r\n                         Sale.ReturnedType, Sale.ReturnedDt, Sale.Flag, Sale.Point,PackageNo,\r\n                             (SELECT        PaidAmt\r\n                               FROM            Ssummary\r\n                               WHERE        (Invoice = Sale.Invoice)) AS PaidAmt,\r\n                             (SELECT        ChangeAmt\r\n                               FROM            Ssummary AS Ssummary_1\r\n                               WHERE        (Invoice = Sale.Invoice)) AS ChngAmnt, StyleSize.SSName, StyleSize.PrdName, StyleSize.BTName, StyleSize.GroupName, ShopList.VatRegNo ,\r\n\t\t\t\t\t\t\t   (SELECT RoundValue FROM\tdbo.Ssummary WHERE Ssummary.Invoice=Sale.Invoice) RoundValue\r\n\t\t\t\t\t\t\t   \r\nINTO #sales\r\nFROM            Sale INNER JOIN\r\n                        dbo.vStyleSize StyleSize ON Sale.BarCode = StyleSize.Barcode AND Sale.sBarCode = StyleSize.sBarcode INNER JOIN\r\n                         ShopList ON Sale.ShopID = ShopList.ShopID\r\n\r\nWHERE Invoice=@InvoiceNo\r\n\r\n\r\n\r\n-- insert package data from details\r\nINSERT INTO #sales\r\n        ( SaleDT ,SupID ,Qty ,CPU ,RPP ,RPU ,VPP ,VPU ,WSP ,WSQ ,sBarCode ,\r\n          BarCode ,SQty ,rQty ,rAmt ,rVat ,rDisc ,cInvoice ,ShopID ,PayType ,\r\n          TotalCost ,TotalAmt ,DiscPrcnt ,DiscAmtPrd ,DiscAmt ,VAT ,VATPrd ,\r\n          NetAmt ,PrdSlNo ,CshAmt ,CrdAmt ,Salesman ,Invoice ,CardName ,CardNo ,\r\n          CounterID ,PrvCus ,PrvCusID ,GrandID ,ParentID ,CusName ,Posted ,\r\n          VATPrcnt ,Returned ,ReturnedType ,ReturnedDt ,Flag ,Point ,PaidAmt,\r\n\t\t  ChngAmnt,SSName,PrdName,BTName,GroupName,VatRegNo,PackageNo,RoundValue\r\n        )\r\nSELECT   SaleDT , '' ,0 ,0 ,0, (SELECT TOP 1 PackagePrice FROM Package WHERE Package.PackageNo=#sales.PackageNo) ,0 ,0 ,0 ,0 ,PackageNo ,PackageNo ,\r\n       SUM(SQty)/(SELECT SUM (Qty) FROM Package WHERE Package.PackageNo=#sales.PackageNo),\r\n\t   0 ,0,0,0,cInvoice ,ShopID ,PayType ,SUM(TotalCost) ,SUM(TotalAmt) ,\r\n       DiscPrcnt ,DiscAmtPrd ,DiscAmt ,VAT , SUM(VATPrd) ,NetAmt ,PrdSlNo ,CshAmt ,CrdAmt ,\r\n       Salesman  ,Invoice ,CardName ,CardNo ,CounterID ,PrvCus ,PrvCusID ,GrandID ,\r\n       ParentID ,CusName ,Posted ,MAX(VATPrcnt) ,Returned ,ReturnedType ,ReturnedDt ,\r\n       Flag,Point ,PaidAmt ,ChngAmnt ,'' ,\r\n\t   (SELECT TOP 1 PName FROM Package WHERE Package.PackageNo=#sales.PackageNo) ,\r\n\t   '' ,'',\r\n       VatRegNo,'',\r\n\t    RoundValue\r\n\t\t FROM #sales WHERE ISNULL(PackageNo,'') <> ''\r\n\t   GROUP BY SaleDT  ,PackageNo,cInvoice,ShopID ,PayType ,DiscPrcnt,DiscAmtPrd,\r\n\t   DiscAmt ,VAT,NetAmt ,PrdSlNo ,CshAmt ,CrdAmt ,\r\n       Salesman ,Invoice ,CardName ,CardNo ,CounterID ,PrvCus ,PrvCusID ,GrandID ,\r\n       ParentID ,CusName ,Posted ,Returned ,ReturnedType ,ReturnedDt ,\r\n       Flag,Point,PaidAmt ,ChngAmnt,VatRegNo,RoundValue\r\n\r\n\r\n-- delete package details / item wise data\r\nDELETE FROM #sales  WHERE ISNULL(PackageNo,'') <> ''\r\n\r\n\r\nSELECT * FROM #sales\r\n\r\nDROP TABLE #sales\r\n\r\nEND\r\n\r\n                           INSERT INTO DbChangerLog VALUES (" + (object) 13 + ") "
      },
      new DBChanger()
      {
        Id = 14,
        Query = "ALTER TABLE dbo.TempSalesVoid\r\n                        ALTER COLUMN SQty money",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 14 + ")"
      },
      new DBChanger()
      {
        Id = 15,
        Query = "ALTER TABLE dbo.TempSalesVoid\r\n                        ALTER COLUMN EQty money",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 15 + ")"
      },
      new DBChanger()
      {
        Id = 16,
        Query = "ALTER TABLE dbo.TempSalesVoid\r\n                        ALTER COLUMN RQty money",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 16 + ")"
      },
      new DBChanger()
      {
        Id = 17,
        Query = "ALTER PROCEDURE dbo.SP_ReportStockPeriodical (\r\n@FromDate NVARCHAR(50),@ToDate NVARCHAR(50),@ShopId NVARCHAR(50)\r\n, @BTID NVARCHAR(50) , @GroupID NVARCHAR(50),@ProductId NVARCHAR(50)\r\n,@SupId NVARCHAR(50) , @Condition NVARCHAR(50)\r\n)\r\nas\r\nBEGIN\r\n-- SP_ReportStockPeriodical '11/01/2015','11/20/2015','0003',   'ALL','ALL','ALL','ALL','>0'\r\n\r\nSELECT uf.sBarCode ,\r\n          uf.BarCode ,\r\n          uf.ShopID ,\r\n          ClosingQty ,\r\n          rcvQty ,\r\n          Sqty ,\r\n          TrnQty ,\r\n          OpeningQty ,ss.GroupName,ss.PrdName,ss.BTName,ss.SSName,ss.SupID,ss.SupName,ss.RPU,ss.CPU\r\nFROM dbo.ufnGetBuyPeriodicalData(@FromDate,@ToDate,@ShopId) uf\r\nINNER JOIN dbo.StyleSize ss ON uf.sBarCode=ss.sBarCode AND uf.BarCode=ss.BarCode\r\n\r\nWHERE ((ShopID=@ShopId AND @ShopId <> 'ALL') OR (@ShopId='ALL'))\r\nAND ((BTID=@BTID AND @BTID <> 'ALL') OR (@BTID='ALL'))\r\nAND ((GroupID=@GroupID AND @GroupID <> 'ALL') OR (@GroupID='ALL'))\r\nAND ((PrdID=@ProductId AND @ProductId <> 'ALL') OR (@ProductId='ALL'))\r\nAND ((SupID=@SupId AND @SupId <> 'ALL') OR (@SupId='ALL'))\r\n\r\nAND ((ClosingQty > 0 AND @Condition='NONZERO') OR (ClosingQty = 0 AND @Condition='ZERO') OR ( @Condition='ALL'))\r\n\r\nend",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 17 + ") "
      },
      new DBChanger()
      {
        Id = 18,
        Query = "ALTER PROCEDURE dbo.sp_getPromotionItem \r\n\t-- Add the parameters for the stored procedure here\r\n\t@createuser NVARCHAR(50)\r\nAS\r\nBEGIN\r\n-- [sp_getPromotionItem] 'admin'\r\n\t\t\t\t\r\n\t\t\t--Select ItemBarcode, BuyQty, PBarCode, SQty from PromotionBuy p\r\n\t\t\t--\tLeft Outer Join TempSales t on t.PBarCode = p.ItemBarcode\r\n\t\t\t-- where p.PromotionNameId = 1 and t.CreateBy ='Superuser'\r\n\r\n\t\t--DEClare @createuser nvarchar(30)\r\n\r\n\t\t\t--set @createuser ='Superuser'\r\n\t\t\t \t Create table #temp\r\n\t\t\t (\r\n\t\t\t\tPromotionNo nvarchar(50),\r\n\t\t\t\tBarcode nvarchar(50),\r\n\t\t\t\tBuyQty int,\r\n\t\t\t\tSqty int,\r\n\t\t\t\tMinGetQty int,\r\n\t\t\t\tIsFree nvarchar(50),\r\n\t\t\t\t--FreeQty INT\r\n\t\t\t )\r\n\r\n\t\t\t Create table #Ftemp\r\n\t\t\t (\r\n\t\t\t\tPromotionNo nvarchar(50),\r\n\t\t\t\tBuyQty INT,\r\n\t\t\t\tGetQty int,\r\n\t\t\t\tSQty int,\r\n\t\t\t\tItemListCount int,\r\n\t\t\t\tFreeQty int,\r\n\r\n\t\t     )\r\n\r\n\t\t\tDEclare @ID nvarchar(50)\r\n\r\n\t\t\tDeclare MY_data CURSOR FOR\r\n\r\n\t\t\t (Select distinct BuyGetNo from dbo.BuyAndGet WHERE CONVERT(DATE, GETDATE(),101) between StartDate and EndDate)\r\n\r\n\t\t\t OPEN MY_data\r\n\t\t\t\tFETCH NEXT FROM MY_data INTO @ID\r\n\t\t\t\t\tWHILE @@FETCH_STATUS = 0\r\n\t\t\t\t\tBEGIN\r\n\t\t\t\t\t\tdelete from #temp\t\r\n\t\t\t\t\t\tInsert Into #temp( PromotionNo,\tBarcode,BuyQty,Sqty,MinGetQty,IsFree)\r\n\t\t\t\t\t\tSelect BuyGetNo, Barcode, Qty, (Select SUM(SQty) from TempSales t where t.Barcode = p.Barcode and t.UserId = @createuser and IsFree='N') Sqty,\r\n\t\t\t\t\t\tfloor(Coalesce((Select SUM(SQty) from TempSales t where t.Barcode = p.Barcode and t.UserId = @createuser and t.IsFree ='N'),0)/Qty) ,IsFree\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfrom dbo.BuyAndGet p\t\t\t\r\n\t\t\t\t\t\twhere p.BuyGetNo = @ID  and p.IsFree ='Buy'\r\n\t\t\t\t\t\t--SELECT * FROM #temp\r\n\r\n\t\t\t\t\t\tIf Not exists( Select * from #temp where MinGetQty <1)\r\n\t\t\t\t\t\t begin\r\n\t\t\t\t\t\t\tinsert into #Ftemp(PromotionNo,BuyQty,GetQty,SQty,ItemListCount,FreeQty)\r\n\t\t\t\t\t\t\tSELECT TOP 1  PromotionNo, BuyQty, MIN(MinGetQty) GetQty,(SELECT SUM(Sqty) FROM #temp)\r\n\t\t\t\t\t\t\t,(SELECT COUNT(*) FROM dbo.BuyAndGet WHERE BuyGetNo=@ID AND BuyAndGet.Barcode=#temp.BarCode AND dbo.BuyAndGet.IsFree='Free')\r\n\t\t\t\t\t\t\t,(SELECT SUM(Qty) FROM dbo.BuyAndGet WHERE BuyGetNo=@ID AND dbo.BuyAndGet.IsFree='Free' ) FreeQty\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tFROM #temp    \r\n\t\t\t\t\t\t\tgroup by PromotionNo,Sqty,BuyQty,#temp.BarCode\r\n\t\t\t\t\t\t\tORDER BY MIN(MinGetQty)\r\n\t\t\t\t\t\t END\r\n\t\t \r\n\t\t\t\t\t\t FETCH NEXT FROM MY_data INTO @ID\r\n\t\t\t\t\tEND\r\n\t\t\t\tCLOSE MY_data\r\n\t\t\tDEALLOCATE MY_data\r\n\r\n\t\t\tSELECT  PromotionNo,GetQty ,BarCode\r\n\t\t\t, (SELECT PrdName+' - '+BTName + '-' + SSName FROM vStyleSize WHERE vStyleSize.Barcode=BuyAndGet.BarCode) ProdcutDescription\r\n\t\t\t, ISNULL((SELECT RPU FROM dbo.Buy WHERE Buy.Barcode=BuyAndGet.BarCode),0) RPU\r\n\t\t\t, ISNULL((SELECT CPU FROM dbo.Buy WHERE Buy.Barcode=BuyAndGet.BarCode),0) CPU\r\n\t\t\t,SQty,ItemListCount,\r\n\t\t\tCASE WHEN (ItemListCount=1) THEN 1 ELSE 0 END AS ExchagePossible,\r\n\t\t\tBuyQty,FreeQty\r\n            \r\n\t\t\tFROM #Ftemp INNER JOIN dbo.BuyAndGet ON #Ftemp.PromotionNo=dbo.BuyAndGet.BuyGetNo\r\n\t\t\tWHERE dbo.BuyAndGet.IsFree='Free' \r\n\r\n\t\t\tDrop table #Ftemp\r\n\t\t\tDrop table #temp\t\r\nEND",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 18 + ") "
      },
      new DBChanger()
      {
        Id = 19,
        Query = "CREATE TABLE [dbo].[InventorySession](\r\n\t                        [SessionId] [NVARCHAR](50) NOT NULL,\r\n                         CONSTRAINT [PK_InventorySession] PRIMARY KEY CLUSTERED \r\n                        (\r\n\t                        [SessionId] ASC\r\n                        )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\r\n                        ) ON [PRIMARY]\r\n\r\n                        GO",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 19 + ") "
      },
      new DBChanger()
      {
        Id = 20,
        Query = "CREATE TABLE [dbo].[Inventory](\r\n\t                        [AutoSessionId] [NUMERIC](18, 0) IDENTITY(1,1) NOT NULL,\r\n\t                        [SessionId] [NVARCHAR](50) NOT NULL,\r\n\t                        [Barcode] [NVARCHAR](50) NULL,\r\n\t                        [ScanQty] [MONEY] NULL,\r\n\t                        [BalQty] [MONEY] NULL,\r\n\t                        [CPU] [MONEY] NULL,\r\n\t                        [RPU] [MONEY] NULL,\r\n\t                        [InventoryDate] [DATE] NULL,\r\n\t                        [UserId] [NVARCHAR](50) NULL,\r\n\t                        [ShopId] [NVARCHAR](50) NULL,\r\n\t                        [Transfer] [NVARCHAR](1) NULL,\r\n                         CONSTRAINT [PK_Inventory] PRIMARY KEY CLUSTERED \r\n                        (\r\n\t                        [AutoSessionId] ASC\r\n                        )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\r\n                        ) ON [PRIMARY]\r\n\r\n                        GO",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 20 + ") "
      },
      new DBChanger()
      {
        Id = 21,
        Query = "\r\n                        CREATE TABLE [dbo].[InventoryDetails](\r\n\t                        [AutoSessionId] [NUMERIC](18, 0) IDENTITY(1,1) NOT NULL,\r\n\t                        [SessionId] [NVARCHAR](50) NOT NULL,\r\n\t                        [Barcode] [NVARCHAR](50) NULL,\r\n\t                        [ScanQty] [MONEY] NULL,\r\n\t                        [UserId] [NVARCHAR](50) NULL,\r\n\t                        [CounterId] [NVARCHAR](50) NULL,\r\n\t                        [UpdateDate] [DATE] NULL,\r\n\t                        [ShopId] [NVARCHAR](50) NULL,\r\n\t                        [Transfer] [NVARCHAR](1) NULL,\r\n\t                        [RPU] [MONEY] NULL,\r\n                         CONSTRAINT [PK_InventoryDetails] PRIMARY KEY CLUSTERED \r\n                        (\r\n\t                        [AutoSessionId] ASC\r\n                        )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\r\n                        ) ON [PRIMARY]\r\n\r\n                        GO",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 21 + ") "
      },
      new DBChanger()
      {
        Id = 22,
        Query = "ALTER TABLE dbo.Buy\r\n                        ALTER COLUMN woffQty money\r\n                        ALTER COLUMN wonQty money",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 22 + ")"
      },
      new DBChanger()
      {
        Id = 23,
        Query = "ALTER FUNCTION dbo.ufnGetBuyPeriodicalData(@FromDate NVARCHAR(50),@ToDate NVARCHAR(50),@ShopId NVARCHAR(50))\r\n                                    RETURNS @retContactInformation TABLE \r\n                                    (\r\n                                        -- Columns returned by the function\r\n                                        sBarCode NVARCHAR(50), \r\n                                        BarCode nvarchar(50) , \r\n                                        ShopID nvarchar(50) NULL, \r\n                                        ClosingQty DECIMAL(18,2), \r\n                                        rcvQty DECIMAL(18,2), \r\n                                        Sqty DECIMAL(18,2), \r\n                                        TrnQty DECIMAL(18,2), \r\n                                        OpeningQty DECIMAL(18,2)\r\n\t                                    ,woffQty DECIMAL(18,3), \r\n                                        wonQty DECIMAL(18,3),\r\n\t\t\t\t\t\t                DmlQty DECIMAL(18,3)\r\n\r\n                                    )\r\n                                    AS\r\n\r\n                                    BEGIN\r\n\t\r\n\r\n                                    --DECLARE @FromDate NVARCHAR(50)\r\n                                    --DECLARE @ToDate NVARCHAR(50)\r\n\r\n                                    --DECLARE @ShopId NVARCHAR(50)\r\n\r\n\r\n                                    --SET @ShopId='ALL'\r\n                                    --SET @FromDate='11/01/2015'\r\n                                    --SET @ToDate='11/23/2015'\r\n\r\n                                    DECLARE @CurrentDate NVARCHAR(50)\r\n\r\n                                    SET @CurrentDate=CONVERT(DATE,GETDATE(),101)\r\n\r\n                                    -- table declaration for closing stock\r\n\r\n                                    DECLARE @rChallan TABLE (\r\n\t                                    sBarCode NVARCHAR(50),\r\n\t                                    BarCode NVARCHAR(50),\r\n\t                                    ShopID NVARCHAR(50),\r\n\t                                    rcvQty DECIMAL(18,2)\r\n                                    )\r\n\r\n                                    DECLARE @Sales TABLE (\r\n\t                                    sBarCode NVARCHAR(50),\r\n\t                                    BarCode NVARCHAR(50),\r\n\t                                    ShopID NVARCHAR(50),\r\n\t                                    Sqty DECIMAL(18,2)\r\n                                    )\r\n\r\n                                    DECLARE @StockReturnShop TABLE (\r\n\t                                    sBarCode NVARCHAR(50),\r\n\t                                    BarCode NVARCHAR(50),\r\n\t                                    ShopID NVARCHAR(50),\r\n\t                                    TrnQty DECIMAL(18,2)\r\n                                    )\r\n\r\n\t\t\t\t\t\t            DECLARE @DMLShop TABLE (\r\n\t\t\t\t\t\t\t\t            sBarCode NVARCHAR(50),\r\n\t\t\t\t\t\t\t\t            BarCode NVARCHAR(50),\r\n\t\t\t\t\t\t\t\t            ShopID NVARCHAR(50),\r\n\t\t\t\t\t\t\t\t            DMLQty DECIMAL(18,3)\r\n\t\t\t\t\t\t\t            )\r\n\r\n                                    DECLARE @Woff TABLE (\r\n\t                                    sBarCode NVARCHAR(50),\r\n\t                                    BarCode NVARCHAR(50),\r\n\t                                    ShopID NVARCHAR(50),\r\n\t                                    woffQty DECIMAL(18,3)\r\n                                    )\r\n\r\n                                    DECLARE @Won TABLE (\r\n\t                                    sBarCode NVARCHAR(50),\r\n\t                                    BarCode NVARCHAR(50),\r\n\t                                    ShopID NVARCHAR(50),\r\n\t                                    wonQty DECIMAL(18,3)\r\n                                    )\r\n\r\n\r\n                                    DECLARE @ClosingStock TABLE (\r\n\t                                    sBarCode NVARCHAR(50),\r\n\t                                    BarCode NVARCHAR(50),\r\n\t                                    ShopID NVARCHAR(50),\r\n\t                                    ClosingQty DECIMAL(18,2)\r\n                                    )\r\n\r\n\r\n\r\n\r\n                                    DECLARE @rChallan2 TABLE (\r\n\t                                    sBarCode NVARCHAR(50),\r\n\t                                    BarCode NVARCHAR(50),\r\n\t                                    ShopID NVARCHAR(50),\r\n\t                                    rcvQty DECIMAL(18,2)\r\n                                    )\r\n\r\n                                    DECLARE @Sales2 TABLE (\r\n\t                                    sBarCode NVARCHAR(50),\r\n\t                                    BarCode NVARCHAR(50),\r\n\t                                    ShopID NVARCHAR(50),\r\n\t                                    Sqty DECIMAL(18,2)\r\n                                    )\r\n\r\n\t\t\t\t\t\t            DECLARE @DMLShop2 TABLE (\r\n\t\t\t\t\t\t\t            sBarCode NVARCHAR(50),\r\n\t\t\t\t\t\t\t            BarCode NVARCHAR(50),\r\n\t\t\t\t\t\t\t            ShopID NVARCHAR(50),\r\n\t\t\t\t\t\t\t            DMLQty DECIMAL(18,3)\r\n\t\t\t\t\t\t            )\r\n\r\n                                    DECLARE @StockReturnShop2 TABLE (\r\n\t                                    sBarCode NVARCHAR(50),\r\n\t                                    BarCode NVARCHAR(50),\r\n\t                                    ShopID NVARCHAR(50),\r\n\t                                    TrnQty DECIMAL(18,2)\r\n                                    )\r\n\r\n                                    DECLARE @Woff2 TABLE (\r\n\t                                    sBarCode NVARCHAR(50),\r\n\t                                    BarCode NVARCHAR(50),\r\n\t                                    ShopID NVARCHAR(50),\r\n\t                                    woffQty DECIMAL(18,3)\r\n                                    )\r\n\r\n                                    DECLARE @Won2 TABLE (\r\n\t                                    sBarCode NVARCHAR(50),\r\n\t                                    BarCode NVARCHAR(50),\r\n\t                                    ShopID NVARCHAR(50),\r\n\t                                    wonQty DECIMAL(18,3)\r\n                                    )\r\n\r\n\r\n                                    -- end table declaration\r\n\r\n\r\n                                    -- closing stock calculation\r\n\r\n\r\n                                    INSERT INTO @rChallan\r\n                                            ( sBarCode, BarCode, ShopID, rcvQty )\r\n                                    SELECT sBarCode,BarCode,ShopID,SUM(Qty ) rcvQty\r\n                                    FROM rChallan\r\n                                    WHERE BuyDT BETWEEN @ToDate AND @CurrentDate\r\n                                    AND (((ShopID=@ShopId) AND (@ShopId<>'ALL')) OR (@ShopId='ALL'))\r\n                                    GROUP BY sBarCode,BarCode,ShopID\r\n\r\n\r\n                                    INSERT INTO @Sales\r\n                                            ( sBarCode, BarCode, ShopID, Sqty )\r\n                                    SELECT sBarCode,BarCode,ShopID,SUM(SQty-rQty) Sqty \r\n                                    FROM dbo.Sale\r\n                                    WHERE CONVERT(DATE,SaleDT,101) BETWEEN @ToDate AND @CurrentDate\r\n                                    AND (((ShopID=@ShopId) AND (@ShopId<>'ALL')) OR (@ShopId='ALL'))\r\n\r\n                                    GROUP BY sBarCode,BarCode,ShopID\r\n\r\n\r\n                                    INSERT INTO @StockReturnShop\r\n                                            ( sBarCode, BarCode, ShopID, TrnQty )\r\n                                    SELECT sBarcode,BarCode,ShopID,SUM(Qty) TrnQty\r\n                                    FROM dbo.StockReturnShop\r\n                                    WHERE CONVERT(DATE,ReturnDt,101) BETWEEN @ToDate AND @CurrentDate\r\n                                    AND (((ShopID=@ShopId) AND (@ShopId<>'ALL')) OR (@ShopId='ALL'))\r\n\r\n                                    GROUP BY sBarCode,BarCode,ShopID\r\n\r\n\r\n\r\n\t\t\t\t\t\t            INSERT INTO @DMLShop\r\n\t\t\t\t\t\t\t\t\t            ( sBarCode, BarCode, ShopID, DMLQty )\r\n\t\t\t\t\t\t\t            SELECT sBarcode,BarCode,ShopID,SUM(Qty) DMLQty\r\n\t\t\t\t\t\t\t            FROM dbo.StockDML\r\n\t\t\t\t\t\t\t            WHERE CONVERT(DATE,ReturnDt,101) > @ToDate AND CONVERT(DATE,ReturnDt,101) <= @CurrentDate\r\n\t\t\t\t\t\t\t            AND (((ShopID=@ShopId) AND (@ShopId<>'ALL')) OR (@ShopId='ALL'))\r\n\t\t\t\t\t\t\t            GROUP BY sBarCode,BarCode,ShopID\r\n\r\n\r\n                                    INSERT INTO @Woff\r\n                                            ( sBarCode, BarCode, ShopID, woffQty )\r\n                                    SELECT sBarcode,Inventory.BarCode,ShopID,SUM( CASE WHEN (BalQty>ScanQty) THEN BalQty-ScanQty ELSE 0 end ) Supret\r\n                                    FROM dbo.Inventory INNER JOIN dbo.StyleSize ON StyleSize.Barcode = Inventory.Barcode\r\n                                    WHERE CONVERT(DATE,InventoryDate,101) > @ToDate AND CONVERT(DATE,InventoryDate,101) <= @CurrentDate\r\n                                    AND (((ShopID=@ShopId) AND (@ShopId<>'ALL')) OR (@ShopId='ALL'))\r\n\r\n                                    GROUP BY sBarCode,Inventory.BarCode,ShopID\r\n\r\n\r\n                                    INSERT INTO @Won\r\n                                            ( sBarCode, BarCode, ShopID, wonQty )\r\n                                    SELECT sBarcode,Inventory.BarCode,ShopID,SUM( CASE WHEN (ScanQty>BalQty) THEN ScanQty-BalQty ELSE 0 end ) Supret\r\n                                    FROM dbo.Inventory INNER JOIN dbo.StyleSize ON StyleSize.Barcode = Inventory.Barcode\r\n                                    WHERE CONVERT(DATE,InventoryDate,101) > @ToDate AND CONVERT(DATE,InventoryDate,101) <= @CurrentDate\r\n                                    AND (((ShopID=@ShopId) AND (@ShopId<>'ALL')) OR (@ShopId='ALL'))\r\n\r\n                                    GROUP BY sBarCode,Inventory.BarCode,ShopID\r\n\r\n\r\n\r\n                                    INSERT INTO @ClosingStock\r\n                                            ( sBarCode ,BarCode ,ShopID ,ClosingQty )\r\n                                    SELECT b.sBarCode,b.BarCode,b.ShopID,\r\n                                    (balQty - ISNULL([@rChallan].rcvQty,0) + ISNULL([@Sales].Sqty,0) + ISNULL(sr.TrnQty,0)  + ISNULL(wof.woffQty,0) - ISNULL(won.wonQty,0) + ISNULL(dml.DMLQty,0)  ) ClosingQty\r\n\r\n                                    FROM Buy b\r\n                                    left JOIN @rChallan ON [@rChallan].BarCode = b.BarCode AND [@rChallan].ShopID = b.ShopID\r\n                                    left JOIN @Sales ON [@Sales].BarCode = b.BarCode AND [@Sales].ShopID = b.ShopID\r\n                                    left JOIN @StockReturnShop sr ON sr.BarCode = b.BarCode AND sr.ShopID = b.ShopID\r\n\t\t\t\t\t\t            LEFT JOIN @DMLShop dml ON dml.BarCode = b.BarCode AND dml.ShopID = b.ShopID\r\n\r\n\r\n                                    left JOIN @Woff wof ON wof.BarCode = b.BarCode AND wof.ShopID = b.ShopID\r\n                                    left JOIN @Won won ON won.BarCode = b.BarCode AND won.ShopID = b.ShopID\r\n\r\n                                    WHERE (((b.ShopID=@ShopId) AND (@ShopId<>'ALL')) OR (@ShopId='ALL'))\r\n                                    -- End closing stock calculation\r\n\r\n\r\n\r\n                                    INSERT INTO @rChallan2\r\n                                            ( sBarCode, BarCode, ShopID, rcvQty )\r\n                                    SELECT sBarCode,BarCode,ShopID,SUM(Qty ) rcvQty\r\n                                    FROM rChallan\r\n                                    WHERE BuyDT BETWEEN @FromDate AND @ToDate\r\n                                    AND (((ShopID=@ShopId) AND (@ShopId<>'ALL')) OR (@ShopId='ALL'))\r\n\r\n                                    GROUP BY sBarCode,BarCode,ShopID\r\n\r\n\r\n                                    INSERT INTO @Sales2\r\n                                            ( sBarCode, BarCode, ShopID, Sqty )\r\n                                    SELECT sBarCode,BarCode,ShopID,SUM(SQty-rQty) Sqty \r\n                                    FROM dbo.Sale\r\n                                    WHERE CONVERT(DATE,SaleDT,101) BETWEEN @FromDate AND @ToDate\r\n                                    AND (((ShopID=@ShopId) AND (@ShopId<>'ALL')) OR (@ShopId='ALL'))\r\n\r\n                                    GROUP BY sBarCode,BarCode,ShopID\r\n\r\n                                    INSERT INTO @StockReturnShop2\r\n                                            ( sBarCode, BarCode, ShopID, TrnQty )\r\n                                    SELECT sBarcode,BarCode,ShopID,SUM(Qty) TrnQty\r\n                                    FROM dbo.StockReturnShop\r\n                                    WHERE CONVERT(DATE,ReturnDt,101) BETWEEN @FromDate AND @ToDate\r\n                                    AND (((ShopID=@ShopId) AND (@ShopId<>'ALL')) OR (@ShopId='ALL'))\r\n\r\n                                    GROUP BY sBarCode,BarCode,ShopID\r\n\r\n\r\n\t\t\t\t\t\t            INSERT INTO @DMLShop2\r\n\t\t\t\t\t\t\t\t\t\t            ( sBarCode, BarCode, ShopID, DMLQty )\r\n\t\t\t\t\t\t\t\t            SELECT sBarcode,BarCode,ShopID,SUM(Qty) DMLQty\r\n\t\t\t\t\t\t\t\t            FROM dbo.StockDML\r\n\t\t\t\t\t\t\t\t            WHERE CONVERT(DATE,ReturnDt,101) BETWEEN @FromDate AND @ToDate\r\n\t\t\t\t\t\t\t\t            AND (((ShopID=@ShopId) AND (@ShopId<>'ALL')) OR (@ShopId='ALL'))\r\n\t\t\t\t\t\t\t\t            GROUP BY sBarCode,BarCode,ShopID\r\n\r\n\r\n                                    INSERT INTO @Woff2\r\n                                            ( sBarCode, BarCode, ShopID, woffQty )\r\n                                    SELECT sBarcode,Inventory.BarCode,ShopID,SUM( CASE WHEN (BalQty>ScanQty) THEN BalQty-ScanQty ELSE 0 end ) woffQty\r\n                                    FROM dbo.Inventory INNER JOIN dbo.StyleSize ON StyleSize.Barcode = Inventory.Barcode\r\n                                    WHERE CONVERT(DATE,InventoryDate,101) >= @FromDate AND CONVERT(DATE,InventoryDate,101) <= @ToDate\r\n                                    AND (((ShopID=@ShopId) AND (@ShopId<>'ALL')) OR (@ShopId='ALL'))\r\n\r\n                                    GROUP BY sBarCode,Inventory.BarCode,ShopID\r\n\r\n\r\n                                    INSERT INTO @Won2\r\n                                            ( sBarCode, BarCode, ShopID, wonQty )\r\n                                    SELECT sBarcode,Inventory.BarCode,ShopID,SUM( CASE WHEN (ScanQty>BalQty) THEN ScanQty-BalQty ELSE 0 end ) wonQty\r\n                                    FROM dbo.Inventory INNER JOIN dbo.StyleSize ON StyleSize.Barcode = Inventory.Barcode\r\n                                    WHERE CONVERT(DATE,InventoryDate,101) >= @FromDate AND CONVERT(DATE,InventoryDate,101) <= @ToDate\r\n                                    AND (((ShopID=@ShopId) AND (@ShopId<>'ALL')) OR (@ShopId='ALL'))\r\n                                    GROUP BY sBarcode,Inventory.BarCode,ShopID\r\n\r\n\r\n\r\n                                    INSERT INTO @retContactInformation\r\n                                            ( sBarCode ,\r\n                                              BarCode ,\r\n                                              ShopID ,\r\n                                              ClosingQty ,\r\n                                              rcvQty ,\r\n                                              Sqty ,\r\n                                              TrnQty ,\r\n                                              OpeningQty\r\n\t\t                                      , wonQty ,\r\n                                              woffQty , DmlQty\r\n                                            )\r\n\r\n                                    SELECT cs.sBarCode ,cs.BarCode ,cs.ShopID ,\r\n                                           ClosingQty ,ISNULL(rcvQty,0) rcvQty,ISNULL(Sqty,0) Sqty,ISNULL(sr.TrnQty,0) TrnQty, ClosingQty +ISNULL(Sqty,0) - ISNULL(rcvQty,0) + ISNULL(sr.TrnQty,0)  + ISNULL(dml.DMLQty,0) + ISNULL(wof.woffQty,0) - ISNULL(won.wonQty,0) AS OpeningQty\r\n\t                                      ,ISNULL(wof.woffQty,0) woffQty , ISNULL(won.wonQty,0) wonQty ,  ISNULL(dml.DMLQty,0)\r\n\t   \r\n                                    FROM @ClosingStock cs\r\n                                    left JOIN @rChallan2 rcv ON rcv.BarCode = cs.BarCode AND rcv.ShopID = cs.ShopID\r\n                                    left JOIN @Sales2 s ON s.BarCode = cs.BarCode AND s.ShopID = cs.ShopID\r\n                                    left JOIN @StockReturnShop2 sr ON sr.BarCode = cs.BarCode AND sr.ShopID = cs.ShopID\r\n\t\t\t\t\t\t            LEFT JOIN @DMLShop2 dml ON dml.BarCode = cs.BarCode AND dml.ShopID = cs.ShopID\r\n\r\n                                    left JOIN @Woff2 wof ON wof.BarCode = cs.BarCode AND wof.ShopID = cs.ShopID\r\n                                    left JOIN @Won2 won ON won.BarCode = cs.BarCode AND won.ShopID = cs.ShopID\r\n\r\n                                    RETURN\r\n\r\n                                    END\r\n                                    GO\r\n                                    ",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 23 + ")"
      },
      new DBChanger()
      {
        Id = 24,
        Query = "ALTER PROCEDURE dbo.SP_ReportStockPeriodical (\r\n                        @FromDate NVARCHAR(50),@ToDate NVARCHAR(50),@ShopId NVARCHAR(50)\r\n                        , @BTID NVARCHAR(50) , @GroupID NVARCHAR(50),@ProductId NVARCHAR(50)\r\n                        ,@SupId NVARCHAR(50) , @Condition NVARCHAR(50)\r\n                        )\r\n                        as\r\n                        BEGIN\r\n                        -- SP_ReportStockPeriodical '11/01/2015','11/20/2015','0003',   'ALL','ALL','ALL','ALL','>0'\r\n\r\n                        SELECT uf.sBarCode ,\r\n                                  uf.BarCode ,\r\n                                  uf.ShopID ,\r\n                                  ClosingQty ,\r\n                                  rcvQty ,\r\n                                  Sqty ,\r\n                                  TrnQty ,\r\n                                  OpeningQty ,ss.GroupName,ss.PrdName,ss.BTName,ss.SSName,ss.SupID,ss.SupName,ss.RPU,ss.CPU\r\n\t\t                          ,wonQty,woffQty,DmlQty\r\n                        FROM dbo.ufnGetBuyPeriodicalData(@FromDate,@ToDate,@ShopId) uf\r\n                        INNER JOIN dbo.StyleSize ss ON uf.sBarCode=ss.sBarCode AND uf.BarCode=ss.BarCode\r\n\r\n                        WHERE ((ShopID=@ShopId AND @ShopId <> 'ALL') OR (@ShopId='ALL'))\r\n                        AND ((BTID=@BTID AND @BTID <> 'ALL') OR (@BTID='ALL'))\r\n                        AND ((GroupID=@GroupID AND @GroupID <> 'ALL') OR (@GroupID='ALL'))\r\n                        AND ((PrdID=@ProductId AND @ProductId <> 'ALL') OR (@ProductId='ALL'))\r\n                        AND ((SupID=@SupId AND @SupId <> 'ALL') OR (@SupId='ALL'))\r\n\r\n                        AND ((ClosingQty > 0 AND @Condition='NONZERO') OR (ClosingQty = 0 AND @Condition='ZERO') OR ( @Condition='ALL'))\r\n\r\n                        end",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 24 + ")"
      },
      new DBChanger()
      {
        Id = 25,
        Query = "CREATE TABLE [dbo].[TempRChallanHold](\r\n\t                    [AutoId] [NUMERIC](18, 0) IDENTITY(1,1) NOT NULL,\r\n\t                    [HoldNo] [NVARCHAR](50) NULL,\r\n\t                    [Chln] [NVARCHAR](20) NULL,\r\n\t                    [OrderNo] [NVARCHAR](20) NULL,\r\n\t                    [sBarCode] [NVARCHAR](20) NULL,\r\n\t                    [BarCode] [NVARCHAR](20) NULL,\r\n\t                    [CPU] [MONEY] NULL,\r\n\t                    [ACPU] [MONEY] NULL,\r\n\t                    [RPU] [MONEY] NULL,\r\n\t                    [VPU] [MONEY] NULL,\r\n\t                    [VPP] [MONEY] NULL,\r\n\t                    [DiscPrcnt] [MONEY] NULL,\r\n\t                    [VATPrcnt] [MONEY] NULL,\r\n\t                    [PrdComm] [MONEY] NULL,\r\n\t                    [Qty] [MONEY] NULL,\r\n\t                    [bQty] [MONEY] NULL,\r\n\t                    [sQty] [MONEY] NULL,\r\n\t                    [cSqty] [MONEY] NULL,\r\n\t                    [rQty] [MONEY] NULL,\r\n\t                    [dmlqty] [MONEY] NULL,\r\n\t                    [BuyDT] [SMALLDATETIME] NULL,\r\n\t                    [EXPDT] [SMALLDATETIME] NULL,\r\n\t                    [LastSDT] [SMALLDATETIME] NULL,\r\n\t                    [ShopID] [NVARCHAR](4) NULL,\r\n\t                    [Transfer] [NVARCHAR](1) NULL,\r\n\t                    [TotalPrdComm] [MONEY] NULL,\r\n\t                    [AddPrdComm] [MONEY] NULL,\r\n\t                    [AddiCost] [MONEY] NULL,\r\n\t                    [ChlnTotal] [MONEY] NULL,\r\n\t                    [SupRef] [NVARCHAR](20) NULL,\r\n\t                    [UserID] [NVARCHAR](10) NULL,\r\n\t                    [PrdDescription] [NVARCHAR](550) NULL,\r\n\t                    [SupID] [NVARCHAR](4) NULL,\r\n                     CONSTRAINT [PK_TempRChallanHold] PRIMARY KEY CLUSTERED \r\n                    (\r\n\t                    [AutoId] ASC\r\n                    )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\r\n                    ) ON [PRIMARY]\r\n\r\n                    GO\r\n                    ",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 25 + ")"
      },
      new DBChanger()
      {
        Id = 26,
        Query = "ALTER TABLE dbo.GlobalSetup\r\n                         ALTER COLUMN IsSupplierWiseStock bit ",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 26 + ")"
      },
      new DBChanger()
      {
        Id = 27,
        Query = " ALTER TABLE dbo.StyleSize\r\n                           ALTER COLUMN IsNegativeStockSale bit ",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 27 + ")"
      },
      new DBChanger()
      {
        Id = 28,
        Query = " ALTER TABLE [dbo].[StyleSize] DROP CONSTRAINT [PK_StyleSize];\r\n\r\n                        ALTER TABLE [dbo].[StyleSize] DROP\r\n                        COLUMN [OldsBarcode];\r\n\r\n                        ALTER TABLE [dbo].[StyleSize] ADD CONSTRAINT [PK_StyleSize] PRIMARY KEY CLUSTERED  ([Barcode]);\r\n\r\n                        EXEC sp_refreshview N'[vStyleSize]'; ",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 28 + ")"
      },
      new DBChanger()
      {
        Id = 29,
        Query = " ALTER TABLE dbo.TempStockReturnShop\r\n                           ALTER COLUMN SupId nvarchar(4) ",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 29 + ")"
      },
      new DBChanger()
      {
        Id = 30,
        Query = "ALTER PROCEDURE dbo.SP_GetShopStock(@Barcode NVARCHAR(50) ,@Supplier NVARCHAR(50) )\r\n                        AS\r\n                        -- SP_GetShopStock '000201000200001001','All'\r\n\r\n                        DECLARE @TempSaleQty INT\r\n                        SELECT @TempSaleQty=ISNULL(SUM(Sqty),0) FROM TempSales WHERE Barcode=@Barcode\r\n\r\n\r\n                        DECLARE @TempTransferQty INT\r\n                        SELECT @TempTransferQty=ISNULL(SUM(TQty),0) FROM dbo.TempStockReturnShop \r\n                        WHERE Barcode=@Barcode --AND ShopId=@shopId\r\n\r\n\r\n                        SELECT        Buy.CMPIDX, StyleSize.sBarCode, StyleSize.BarCode, Buy.Chln, Buy.BuyDT, Buy.RPP, Buy.WSP, Buy.WSQ, ISNULL(Buy.DiscPrcnt,dbo.StyleSize.DiscPrcnt) DiscPrcnt , ISNULL(dbo.StyleSize.VATPrcnt,0) VATPrcnt, Buy.PrdComm, Buy.Qty, Buy.bQty, Buy.TrfQty, Buy.sreturn, Buy.sQty, Buy.rQty, \r\n                                                 Buy.SrpQty, Buy.dmlqty, Buy.InvQty, StyleSize.SupID, Buy.EXPDT, Buy.LastSDT, Buy.ShopID, Buy.Transfer, Buy.SupRef, Buy.UserID, Buy.Point, Buy.Reorder, Buy.ZoneID, StyleSize.SSName, Product.PrdName, \r\n                                                 BrandType.BTName, PGroup.GroupName, Supplier.SupName, ISNULL(Buy.balQty,0) - (@TempSaleQty + @TempTransferQty) AS balQty, ISNULL(Buy.CPU, dbo.StyleSize.CPU) CPU , ISNULL(Buy.RPU, dbo.StyleSize.RPU ) RPU\r\n\t\t\t\t\t\t                         ,IsNegativeStockSale\r\n                        FROM            Buy RIGHT OUTER JOIN\r\n                                                 StyleSize ON Buy.BarCode = StyleSize.Barcode AND Buy.sBarCode = StyleSize.sBarcode\r\n\t\t\t\t\t\t                         INNER JOIN dbo.PGroup ON PGroup.GroupID = StyleSize.GroupID\r\n\t\t\t\t\t\t                         INNER JOIN dbo.BrandType ON BrandType.BTID = StyleSize.BTID\r\n\t\t\t\t\t\t                         INNER JOIN dbo.Product ON Product.PrdID = StyleSize.PrdID\r\n\t\t\t\t\t\t                         INNER JOIN dbo.Supplier ON Supplier.SupID = StyleSize.SupID\r\n\r\n                        WHERE StyleSize.BarCode=@Barcode AND\r\n                         --((ShopID=@shopId AND (@shopId<>'All') ) OR (@shopId='All')) \r\n                          ((StyleSize.SupID=@Supplier AND (@Supplier<>'All') ) OR (@Supplier='All')); ",
        QueryLog = " INSERT INTO DbChangerLog VALUES (" + (object) 30 + ")"
      }
    };

        public string InitializeMainLogTable()
        {
            this.result = new SQLDAL().ExecuteQuery("IF NOT EXISTS (SELECT * FROM sys.tables WHERE name='DbChangerLog')\r\n                        BEGIN\r\n\t\t                        CREATE TABLE [dbo].[DbChangerLog](\r\n\t\t                        [QueryId] [INT] NOT NULL,\r\n\t                         CONSTRAINT [PK_DbChangerLog] PRIMARY KEY CLUSTERED \r\n\t                        (\r\n\t\t                        [QueryId] ASC\r\n\t                        )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\r\n\t                        ) ON [PRIMARY]\r\n                        END");
            return this.result.ExecutionState ? "Initiliaze main log table complete" : "Error in Initiliaze main log table  " + this.result.Error;
        }

        public int[] GetAppliedList()
        {
            int[] appliedList = new int[0];
            this.result = new SQLDAL().Select("SELECT QueryId FROM DbChangerLog");
            if (this.result.ExecutionState && this.result.Data != null)
            {
                appliedList = new int[this.result.Data.Rows.Count];
                for (int index = 0; index < this.result.Data.Rows.Count; ++index)
                    appliedList[index] = int.Parse(this.result.Data.Rows[index]["QueryId"].ToString());
            }
            return appliedList;
        }

        public string ExecuteChanges() => "All Db initialized done";
    }
}
